FROM python:3.9-slim

COPY ./LightGBM /opt/LightGBM
ENV DEBIAN_FRONTEND=noninteractive
ENV LANG=C.UTF-8 LC_ALL=C.UTF-8

ARG DASK_VERSION

RUN apt-get update && \
    apt-get install -y --no-install-recommends \
        build-essential \
        cmake \
        libomp-dev && \
    pip install --no-cache-dir \
        blosc \
        bokeh \
        boto3 \
        dask==${DASK_VERSION} \
        dask-cloudprovider \
        dask-ml \
        distributed==${DASK_VERSION} \
        lz4 \
        numpy==1.21.1 \
        pandas==1.3.0 \
        scikit-learn && \
    # install LightGBM
    cd /opt/LightGBM/python-package && \
    python setup.py install && \
    cd /opt && \
    rm -rf /opt/LightGBM && \
    apt-get remove -y --purge \
        cmake \
        build-essential && \
    rm -rf /var/lib/apt/lists/*
